<!--
        JBoss, Home of Professional Open Source
        Copyright 2009, Red Hat, Inc., and others contributors as indicated
        by the @authors tag. All rights reserved.
        See the copyright.txt in the distribution for a
        full listing of individual contributors.
        This copyrighted material is made available to anyone wishing to use,
        modify, copy, or redistribute it subject to the terms and conditions
        of the GNU Lesser General Public License, v. 2.1.
        This program is distributed in the hope that it will be useful, but WITHOUT A
        WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
        PARTICULAR PURPOSE. See the GNU Lesser General Public License for more details.
        You should have received a copy of the GNU Lesser General Public License,
        v.2.1 along with this distribution; if not, write to the Free Software
        Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston,
        MA 02110-1301, USA.
-->
<project name="thirdparty" default="install" xmlns:artifact="urn:maven-artifact-ant">

	<property name="project.home" location="." />
	<property file="${project.home}/build.properties" />

	<property name="build.dir" value="build" />
	<property name="build.dist" value="${build.dir}/dist" />
	<property name="build.lib" value="${build.dir}/lib" />
	<property name="lib.dir" value="lib" />

	<property name="maven.ant.file" value="maven-ant-tasks-2.0.9.jar" />
	<property name="maven.ant.dir" value="http://apache.inetbridge.net/maven/binaries" />

	<available file="${lib.dir}/${maven.ant.file}" type="file" property="maven.lib.exists" />

	<target name="bootstrap" unless="maven.lib.exists">
		<mkdir dir="${lib.dir}" />

		<get src="${maven.ant.dir}/${maven.ant.file}" dest="${lib.dir}/${maven.ant.file}" verbose="true" usetimestamp="true" />
	</target>

	<target name="init" depends="bootstrap">
		<mkdir dir="${build.lib}" />
		<mkdir dir="${build.dir}" />
		<mkdir dir="${build.dist}" />
		<mkdir dir="${build.dist}/include" />
		<mkdir dir="${build.dist}/lib" />
	</target>

	<target name="clean">
		<delete dir="${build.dir}" />
		<delete dir="${build.dist}" />
	</target>

	<target name="install-artifact">
		<typedef resource="org/apache/maven/artifact/ant/antlib.xml" uri="urn:maven-artifact-ant">
			<classpath>
				<pathelement location="${lib.dir}/${maven.ant.file}" />
			</classpath>
		</typedef>

		<artifact:pom id="pom" file="${build.dir}/${artifactId}.pom" />
		<artifact:install file="${build.lib}/${artifactId}.jar">
			<pom refid="pom" />
		</artifact:install>
	</target>

	<macrodef name="create-pom">
		<attribute name="groupId" />
		<attribute name="artifactId" />
		<attribute name="name" />
		<attribute name="version" />
		<attribute name="description" />
		<sequential>
			<echo file="${build.dir}/@{artifactId}.pom" append="false">&lt;project&gt;
        &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
        &lt;groupId&gt;@{groupId}&lt;/groupId&gt;
        &lt;artifactId&gt;@{artifactId}&lt;/artifactId&gt;
        &lt;name&gt;@{name}&lt;/name&gt;
        &lt;version&gt;@{version}&lt;/version&gt;
        &lt;description&gt;@{description}&lt;/description&gt;
&lt;/project&gt;
</echo>
		</sequential>
	</macrodef>

	<target name="init.log4cxx">
		<property name="groupId" value="org.jboss.blacktie.thirdparty" />
		<property name="artifactId" value="log4cxx" />
		<property name="name" value="log4cxx" />
		<property name="version" value="1.0" />
		<property name="description" value="Re-packaging of log4cxx, a logging framework for C++ patterned after Apache log4j" />
		<create-pom groupId="${groupId}" artifactId="${artifactId}" name="${name}" version="${version}" description="${description}" />
	</target>

	<target name="log4cxx" depends="init.log4cxx">
		<property name="log4cxx.include.dir" value="${log4cxx.root}/src/main/include/log4cxx" />
		<available file="${log4cxx.include.dir}" type="dir" property="log4cxx.include.dir.exists" />
		<property name="log4cxx.lib.dir" value="${log4cxx.root}/target/debug/shared" />
		<available file="${log4cxx.lib.dir}" type="dir" property="log4cxx.lib.dir.exists" />

		<fail unless="log4cxx.include.dir.exists" />
		<fail unless="log4cxx.lib.dir.exists" />

		<mkdir dir="${build.dist}/include/log4cxx" />

		<copy file="${log4cxx.lib.dir}/liblog4cxx.so" todir="${build.dist}/lib" />
		<copy todir="${build.dist}/include/log4cxx">
			<fileset dir="${log4cxx.include.dir}" />
		</copy>

		<jar destfile="${build.lib}/${artifactId}.jar">
			<manifest>
				<attribute name="Implementation-Vendor" value="Apache Foundation" />
				<attribute name="Implementation-Title" value="log4cxx" />
				<attribute name="Implementation-Version" value="${log4cxx.version}" />
			</manifest>
			<fileset dir="${build.dist}" />
		</jar>
	</target>

	<target name="stomp">
		<property name="groupId" value="org.jboss.blacktie.thirdparty" />
		<property name="artifactId" value="stomp" />
		<property name="name" value="stomp" />
		<property name="version" value="1.0" />
		<property name="description" value="Re-packaging of stomp, a messaging protocol C library from Codehaus" />
		<create-pom groupId="${groupId}" artifactId="${artifactId}" name="${name}" version="${version}" description="${description}" />
		<property name="stomp.include.dir" value="${stomp.root}/src/" />
		<available file="${stomp.include.dir}" type="dir" property="stomp.include.dir.exists" />
		<property name="stomp.lib.dir" value="${stomp.root}/target/debug/shared" />
		<available file="${stomp.lib.dir}" type="dir" property="stomp.lib.dir.exists" />

		<fail unless="stomp.include.dir.exists" />
		<fail unless="stomp.lib.dir.exists" />

		<mkdir dir="${build.dist}/include" />

		<copy file="${stomp.lib.dir}/libstomp.so" todir="${build.dist}/lib" />
		<copy todir="${build.dist}/include">
			<fileset dir="${stomp.include.dir}" />
		</copy>

		<jar destfile="${build.lib}/${artifactId}.jar">
			<manifest>
				<attribute name="Implementation-Vendor" value="Codehaus" />
				<attribute name="Implementation-Title" value="stomp" />
			</manifest>
			<fileset dir="${build.dist}" />
		</jar>
		
		<typedef resource="org/apache/maven/artifact/ant/antlib.xml" uri="urn:maven-artifact-ant">
			<classpath>
				<pathelement location="${lib.dir}/${maven.ant.file}" />
			</classpath>
		</typedef>

		<artifact:pom id="pom" file="${build.dir}/${artifactId}.pom" />
		<artifact:install file="${build.lib}/${artifactId}.jar">
			<pom refid="pom" />
		</artifact:install>
	</target>

	<target name="apr-1">
		<property name="groupId" value="org.jboss.blacktie.thirdparty" />
		<property name="artifactId" value="apr-1" />
		<property name="name" value="apr-1" />
		<property name="version" value="1.0" />
		<property name="description" value="apr-1" />
		<create-pom groupId="${groupId}" artifactId="${artifactId}" name="${name}" version="${version}" description="${description}" />
		<available file="${apr-1.include.dir}" type="dir" property="apr-1.include.dir.exists" />
		<available file="${apr-1.lib.dir}" type="dir" property="apr-1.lib.dir.exists" />

		<fail unless="apr-1.include.dir.exists" />
		<fail unless="apr-1.lib.dir.exists" />

		<mkdir dir="${build.dist}/include" />

		<copy file="${apr-1.lib.dir}/libapr-1.so" todir="${build.dist}/lib" />
		<copy todir="${build.dist}/include">
			<fileset dir="${apr-1.include.dir}" />
		</copy>

		<jar destfile="${build.lib}/${artifactId}.jar">
			<manifest>
				<attribute name="Implementation-Vendor" value="Apache" />
				<attribute name="Implementation-Title" value="apr-1" />
			</manifest>
			<fileset dir="${build.dist}" />
		</jar>
		
		<typedef resource="org/apache/maven/artifact/ant/antlib.xml" uri="urn:maven-artifact-ant">
			<classpath>
				<pathelement location="${lib.dir}/${maven.ant.file}" />
			</classpath>
		</typedef>

		<artifact:pom id="pom" file="${build.dir}/${artifactId}.pom" />
		<artifact:install file="${build.lib}/${artifactId}.jar">
			<pom refid="pom" />
		</artifact:install>
		
	</target>

	<target name="thirdparty" depends="init,log4cxx,stomp" />

	<target name="install" depends="thirdparty,install-artifact" />
</project>
