
 JBoss, Home of Professional Open Source
 Copyright 2009, Red Hat, Inc., and others contributors as indicated
 by the @authors tag. All rights reserved.
 See the copyright.txt in the distribution for a
 full listing of individual contributors.
 This copyrighted material is made available to anyone wishing to use,
 modify, copy, or redistribute it subject to the terms and conditions
 of the GNU Lesser General Public License, v. 2.1.
 This program is distributed in the hope that it will be useful, but WITHOUT A
 WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
 PARTICULAR PURPOSE.  See the GNU Lesser General Public License for more details.
 You should have received a copy of the GNU Lesser General Public License,
 v.2.1 along with this distribution; if not, write to the Free Software
 Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston,
 MA  02110-1301, USA.


PRE-REQUISITE
Download Berkeley from:
http://www.oracle.com/technology/software/products/berkeley-db/index.html
ON LINUX
Extract to <USER_HOME>/db-4.7.25
Follow the instructions on: http://www.oracle.com/technology/documentation/berkeley-db/db/ref/build_unix/intro.html
	NOTE: We use the default install location of /usr/local/BerkeleyDB.4.7/

ON WINDOWS
Extract to c:\db-4.7.25
Follow the instructions on: http://www.oracle.com/technology/documentation/berkeley-db/db/ref/build_win/intro.html
NOTE I needed to alter the db_dll Linker settings to remove bufferoverflowU
NOTE I needed to alter the build profile to be Debug x86 as the default was 64bit
NOTE I get 3 failures during build two for tcl.h and one for jni.h but I ignore these

NOTE
The file Environment.xml (in the linux and win32 directories) needs to reference the location of the library,
if you install it elsewhere remember to update the <XA_LIB_NAME> tag.

NOTE: You may need to update $BLACKTIE_BIN_DIR/bin/generate-executables.xml to add db-4.7 to the list of libs in 
libsets-main-dependencies (line 43)
NOTE: On windows you need to update that file to add the following includepath:
	<includepath path="C:/db-4.7.25/build_windows/"/>
NOTE: On windows you need to add the following libset
	<libset dir="C:/db-4.7.25/build_windows/Debug" libs="libdb47${lib.suffix}" />
NOTE: You will need to set the PATH/LD_LIBRARY_PATH to include the external library folder for Berkeley


1. SET ENVIRONMENT VARIABLES
In order to run the example you need to make sure that you have set the environment
appropriately. You will need to make sure that you edit the variables with values starting with REPLACE_WITH_: 
On Linux you need to edit:
    $BLACKTIE_BIN_DIR/setenv.sh
On Windows:
    %BLACKTIE_BIN_DIR%\setenv.bat
Then, execute the script setenv

2. CREATE THE CLIENT and SERVER
On Linux:
	 $BLACKTIE_BIN_DIR/bin/generate_client.sh -Dclient.includes="request.c bdb.c ora.c client.c" -Dx.inc.dir="/usr/local/product/11.1.0/db_1/rdbms/public" -Dx.lib.dir="/usr/local/product/11.1.0/db_1/lib" -Dx.libs="occi clntsh"

	$BLACKTIE_BIN_DIR/bin/generate_server.sh -Dservice.names=DBS -Dserver.includes="request.c bdb.c ora.c DbService.c" -Dx.inc.dir="/usr/local/product/11.1.0/db_1/rdbms/public" -Dx.lib.dir="/usr/local/product/11.1.0/db_1/lib" -Dx.libs="occi clntsh"

On Windows:
	 $BLACKTIE_BIN_DIR/bin/generate_client.bat -Dclient.includes="request.c bdb.c ora.c client.c" -Dx.inc.dir="/usr/local/product/11.1.0/db_1/rdbms/public" -Dx.lib.dir="/usr/local/product/11.1.0/db_1/lib" -Dx.libs="occi clntsh"

	$BLACKTIE_BIN_DIR/bin/generate_server.bat -Dservice.names=DBS -Dserver.includes="request.c bdb.c ora.c DbService.c" -Dx.inc.dir="/usr/local/product/11.1.0/db_1/rdbms/public" -Dx.lib.dir="/usr/local/product/11.1.0/db_1/lib" -Dx.libs="occi clntsh"


4. RUN THE APPLICATIONS
Make sure that the naming and transaction services are running, if not, run the JBoss server:
<JBOSS_HOME>/bin/run.sh|bat -c blacktie
4.1 RUN THE SERVER
Make sure any required 3rd party libraries are on the library path. For example:
export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/product/11.1.0/db_1/lib
./server -c <win32|linux>
4.2 RUN THE CLIENT
You will need to set the environment variable BLACKTIE_CONFIGURATION_DIR to either win32 or linux prior to running the client
./client <any arg> to write records
./client to read a single record back

Note: The db records are stored in the directories db1 and db2. To clear out the database just delete the contents
but not the directories themselves (on linux rm db*/*)
